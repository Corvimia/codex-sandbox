FROM node:24-bookworm

# Base tools
RUN apt-get update \
  && apt-get install -y git ca-certificates zsh curl dnsutils gh \
  && rm -rf /var/lib/apt/lists/*

# Non-root user
RUN useradd -m -s /bin/zsh sandbox
RUN mkdir -p /opt/tools
RUN chown -R sandbox:sandbox /opt/tools
RUN mkdir -p /workspace
RUN chown -R sandbox:sandbox /workspace
RUN touch /home/sandbox/.zshrc
RUN chown sandbox:sandbox /home/sandbox/.zshrc
RUN mkdir -p /home/sandbox/.ssh
RUN chmod 700 /home/sandbox/.ssh \
  && chown -R sandbox:sandbox /home/sandbox/.ssh

USER sandbox

ENV HOME=/home/sandbox
ENV PATH="/opt/tools/node_modules/.bin:${PATH}"
WORKDIR /workspace

ENTRYPOINT ["/bin/zsh"]
